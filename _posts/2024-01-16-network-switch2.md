---
title: 스위치의 추가 기능 - STP
excerpt: STP
categories:
  - network
tags:
  - - network
permalink: /network/2024-01-16-network-switch2/
toc: true
toc_sticky: true
date: 2024-01-16
last_modified_at: 2024-01-16
published: true
---

> 🌷 **개요**
>
> **스위치**
>
> - 2계층 장비
> - 네트워크의 가장 핵심적인 장비
> - MAC 주소를 기반으로 동작
>
> **스위치의 기본 동작**
>
> - 네트워크 중간에서 패킷을 받아, 필요한 곳에만 보내준다. (네트워크의 통신을 중재)
> - 아무 설정을 하지 않고 연결만 해도 MAC 주소를 기반으로 패킷을 전달한다.
>
> **추가 기능**
>
> - VLAN 기능 : 논리적으로 네트워크를 분리
> - STP 기능 (스패닝 트리 프로토콜) : 네트워크의 루프 방지

# STP

## 1. 네트워크 루프

- 대부분의 원인 : 브로드캐스트 스톰

### 브로드캐스트 스톰

- 발생

  1. 루프 구조로 네트워크가 연결된 환경
  2. 단말에서 브로드캐스트를 발생시킴
  3. 스위치는 패킷을 모든 포트로 플러딩
  4. 이 패킷을 받은 스위치는 모든 포트로 다시 플러딩
  5. 반복

- 효과
  - 2계층 패킷은 수명을 가지고 있지 않기 때문에 패킷 하나가 죽지 않고 전체 네트워크 대역폭을 차지할 수 있다.
- 결과
  - 네트워크에 접속된 단말의 속도가 느려진다.
  - 네트워크 접속 속도가 느려진다. (거의 통신 불가)
  - 네트워크에 설치된 스위치의 모든 LED가 빠른 속도로 깜빡인다.
- 지속
  - 케이블을 제거할 때까지 네트워크 마비 지속

### MAC 어드래스 플래핑 (스위치 MAC 어드레스 러닝 중복)

- 발생
  1. 스위치는 출발지 MAC 주소를 학습힌다.
  2. 스위치 MAC 주소 테이블에서는 하나의 MAC 주소에 대해 하나의 포트만 학습할 수 있다.
  3. 동일한 MAC 주소가 여러 포트에서 학습되면 MAC 주소 테이블이 중복되어 정상적으로 동작하지 않는다.
- 결과
  - 스위치에서 학습된 주소의 포트가 계속 변경되어 패킷을 플러딩한다.
- 예방
  - 루프 구성 포트 중 하나의 포트만 셧다운 시키면 루프를 예방할 수 있다.
    - 사용자가 직접 포트를 조작하는 것은 바람직하지 않다.

## 2. STP (스패닝 트리 프로토콜)

- 스위치는 BPDU라는 프로토콜을 통해 스위치간의 연결 정보를 전달하고, 이 정보를 이용하여 트리를 만들어 루프 구간을 확인한다.
- 확인된 루프 지점을 차단하여 루프를 예방한다.

###

- 신규스위치가 연결되면 BPDU를 기다려 학습하고 구조를 파악한 후 차단할지 트래픽을 흘릴지 확인
- 처음 연결 (차단 상태) -> 트래픽 흐를때 까지 과정
  - 블락킹 20초
  - 리스닝 15초
  - 러닝 15초
  - 포워딩
